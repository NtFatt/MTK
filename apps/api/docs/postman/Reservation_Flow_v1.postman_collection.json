{
  "info": {
    "_postman_id": "c17f4d5a-9d8a-4a5d-9b18-6a2ab6e97e2a",
    "name": "HadiLao API - Reservation Flow (v1)",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "Healthcheck",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/api/v1/health",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "api",
            "v1",
            "health"
          ]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('status 200', () => pm.response.to.have.status(200));"
            ]
          }
        }
      ]
    },
    {
      "name": "List Tables (for areaName)",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/api/v1/tables",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "api",
            "v1",
            "tables"
          ]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('status 200', () => pm.response.to.have.status(200));"
            ]
          }
        }
      ]
    },
    {
      "name": "Reservation - Availability",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/api/v1/reservations/availability?areaName={{areaName}}&partySize={{partySize}}&reservedFrom={{reservedFrom}}&reservedTo={{reservedTo}}",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "api",
            "v1",
            "reservations",
            "availability"
          ],
          "query": [
            {
              "key": "areaName",
              "value": "{{areaName}}"
            },
            {
              "key": "partySize",
              "value": "{{partySize}}"
            },
            {
              "key": "reservedFrom",
              "value": "{{reservedFrom}}"
            },
            {
              "key": "reservedTo",
              "value": "{{reservedTo}}"
            }
          ]
        }
      },
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "type": "text/javascript",
            "exec": [
              "// Auto-generate reservedFrom/reservedTo (start in +60m, duration 90m)",
              "const now = new Date();",
              "const from = new Date(now.getTime() + 60*60*1000);",
              "const to = new Date(now.getTime() + 150*60*1000);",
              "pm.environment.set('reservedFrom', from.toISOString());",
              "pm.environment.set('reservedTo', to.toISOString());"
            ]
          }
        },
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('status 200', () => pm.response.to.have.status(200));",
              "const json = pm.response.json();",
              "if (json.suggestedTable) {",
              "  pm.environment.set('suggestedTableId', json.suggestedTable.tableId);",
              "}"
            ]
          }
        }
      ]
    },
    {
      "name": "Reservation - Create",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "url": {
          "raw": "{{baseUrl}}/api/v1/reservations",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "api",
            "v1",
            "reservations"
          ]
        },
        "body": {
          "mode": "raw",
          "raw": "{\n  \"areaName\": \"{{areaName}}\",\n  \"partySize\": \"{{partySize}}\",\n  \"contactPhone\": \"{{contactPhone}}\",\n  \"contactName\": \"{{contactName}}\",\n  \"note\": \"{{reservationNote}}\",\n  \"reservedFrom\": \"{{reservedFrom}}\",\n  \"reservedTo\": \"{{reservedTo}}\"\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('status 201', () => pm.response.to.have.status(201));",
              "const json = pm.response.json();",
              "pm.environment.set('reservationCode', json.reservationCode);",
              "pm.environment.set('reservationTableId', json.tableId);"
            ]
          }
        }
      ]
    },
    {
      "name": "Admin - Login",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "url": {
          "raw": "{{baseUrl}}/api/v1/admin/auth/login",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "api",
            "v1",
            "admin",
            "auth",
            "login"
          ]
        },
        "body": {
          "mode": "raw",
          "raw": "{\n  \"username\": \"{{adminUsername}}\",\n  \"password\": \"{{adminPassword}}\"\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('status 200', () => pm.response.to.have.status(200));",
              "const json = pm.response.json();",
              "pm.environment.set('adminToken', json.token);"
            ]
          }
        }
      ]
    },
    {
      "name": "Admin - Confirm Reservation",
      "request": {
        "method": "PATCH",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{adminToken}}"
          }
        ],
        "url": {
          "raw": "{{baseUrl}}/api/v1/admin/reservations/{{reservationCode}}/confirm",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "api",
            "v1",
            "admin",
            "reservations",
            "{{reservationCode}}",
            "confirm"
          ]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('status 200', () => pm.response.to.have.status(200));",
              "const json = pm.response.json();",
              "pm.test('confirmed', () => json.status === 'CONFIRMED');"
            ]
          }
        }
      ]
    },
    {
      "name": "Admin - Check-in (creates table session)",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{adminToken}}"
          }
        ],
        "url": {
          "raw": "{{baseUrl}}/api/v1/admin/reservations/{{reservationCode}}/checkin",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "api",
            "v1",
            "admin",
            "reservations",
            "{{reservationCode}}",
            "checkin"
          ]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('status 200', () => pm.response.to.have.status(200));",
              "const json = pm.response.json();",
              "pm.environment.set('sessionKey', json.sessionKey);",
              "pm.environment.set('checkedInTableId', json.tableId);"
            ]
          }
        }
      ]
    },
    {
      "name": "Cart - Open/Fetch by SessionKey",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/api/v1/carts/session/{{sessionKey}}",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "api",
            "v1",
            "carts",
            "session",
            "{{sessionKey}}"
          ]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('status 200', () => pm.response.to.have.status(200));"
            ]
          }
        }
      ]
    }
  ]
}